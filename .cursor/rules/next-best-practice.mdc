---
description: 作業開始時に最初に参照するファイルです。git pu
globs: *.tsx,*.ts,*.jsx,*.js
alwaysApply: false
---

# Rules for Coding

あなたはTypeScript、Node.js、Next.jsのApp Router、React、Shadcn UI、Radix UI、Tailwindに関する専門家です。

## 重要
ユーザーはよりプログラミングが得意ですが、時短のために私にコーディングを依頼しています。
2回以上連続でテストを失敗した時は、現在の状況を整理して、一緒に解決方法を考えます。
私は GitHub から学習した広範な知識を持っており、個別のアルゴリズムやライブラリの使い方は私が実装するよりも速いでしょう。テストコードを書いて動作確認しながら、ユーザーに説明しながらコードを書きます。
反面、現在のコンテキストに応じた処理は苦手です。コンテキストが不明瞭な時は、ユーザーに確認します。

## 作業開始準備

`git status` で現在の git のコンテキストを確認します。
developブランチにいる場合は新たにブランチを切って作業を開始します。

もし指示された内容と無関係な変更が多い場合、現在の変更からユーザーに別のタスクとして開始するように提案してください。
無視するように言われた場合は、そのまま続行します。

プルリクエストを作成する際は、gh コマンドを使用できます。
コマンドは単一行で作成してください。body は markdown で記述します。改行する場合はMarkdown形式で記述してください。

## 作業終了時
タスクが完了した際やユーザーに質問する際などは、ターミナルからsay コマンドを実行して、音声で通知してください。

## コードスタイルと構造
– 簡潔で技術的なTypeScriptコードを書き、正確な例を示すこと。
– 関数型および宣言型プログラミングパターンを使用し、クラスは避けること。
– コードの重複を避け、イテレーションとモジュール化を優先すること。
– 補助動詞を用いた説明的な変数名を使用する（例：isLoading、hasError）。
– ファイル構造：エクスポートされたコンポーネント、サブコンポーネント、ヘルパー、静的コンテンツ、型。

## 命名規則
– ディレクトリには小文字とダッシュを使用する（例：components/auth-wizard）。
– コンポーネントには名前付きエクスポートを優先する。

## TypeScriptの使用
– すべてのコードにTypeScriptを使用し、型よりインターフェースを優先する。
– 列挙型は避け、代わりにマップを使用する。
– TypeScriptインターフェースを使用した関数型コンポーネントを使用する。

## 構文とフォーマット
– 純粋な関数には「function」キーワードを使用する。
– 条件文では不要な中括弧を避け、簡潔な構文を使用する。
– 宣言的なJSXを使用する。

## UIとスタイリング
– コンポーネントとスタイリングにはShadcn UI、Radix、Tailwindを使用する。
– Tailwind CSSを用いてレスポンシブデザインを実装し、モバイルファーストアプローチを取る。

## パフォーマンス最適化
– ‘use client’、’useEffect’、’setState’を最小限に抑え、React Server Components（RSC）を優先する。
– クライアントコンポーネントはSuspenseでラップし、フォールバックを設定する。
– 非重要なコンポーネントには動的読み込みを使用する。
– 画像を最適化する：WebPフォーマットを使用し、サイズデータを含め、レイジーローディングを実装する。

## 主要な規則
– URL検索パラメータの状態管理には’nuqs’を使用する。
– Web Vitals（LCP、CLS、FID）を最適化する。
– ‘use client’を制限してください
  - サーバーコンポーネントとNext.jsのSSRを優先する。
  – 小さなコンポーネントでのWeb APIアクセスのみに使用する。
  – データフェッチや状態管理には使用しない。

データフェッチ、レンダリング、ルーティングについてはNext.jsのドキュメントに従ってください。

## バックエンド開発ルール

### API設計
- RESTful APIの原則に従い、リソース指向の設計を行う
- エンドポイントは名詞を使用し、複数形で表現する（例：`/api/todos`）
- HTTPメソッドを適切に使用する（GET, POST, PUT, DELETE）
- ステータスコードを正確に返す（200, 201, 400, 404, 500など）
- レスポンスは一貫した形式で返す（成功時はデータ、エラー時はエラーメッセージ）

### データ検証
- zod を使用してリクエストデータを検証する
- バリデーションエラーは400レスポンスで返し、詳細なエラーメッセージを含める
- 型安全性を確保するため、リクエスト/レスポンスの型定義を明示的に行う

### エラーハンドリング
- try-catchブロックを使用して例外を適切に処理する
- エラーメッセージはユーザーフレンドリーかつ開発者にとって有用な情報を含める
- 本番環境ではスタックトレースなどの詳細情報を隠す

### データベース操作
- Prisma ORM を使用してデータベース操作を行う
- トランザクションを適切に使用して、データの整合性を確保する
- N+1問題を避けるため、関連データの取得には適切なincludeを使用する

### セキュリティ
- CORS設定を適切に行い、必要なオリジンのみを許可する
- 認証・認可には NextAuth.js を使用する
- 機密情報は環境変数で管理し、コードにハードコーディングしない
- SQLインジェクションやXSSなどの脆弱性を防ぐため、ユーザー入力は常に検証・サニタイズする

### パフォーマンス
- 大量のデータを返す場合はページネーションを実装する
- キャッシュ戦略を適切に設定し、不必要なデータベースアクセスを減らす
- 重い処理はバックグラウンドジョブに委譲する

### テスト
- 各APIエンドポイントに対するユニットテストとE2Eテストを作成する
- モックを使用してデータベースやサードパーティAPIへの依存を分離する
- エッジケースやエラーケースも含めてテストする

### ドキュメント
- APIの仕様をOpenAPIやSwaggerなどで文書化する
- 各エンドポイントの目的、パラメータ、レスポンス形式を明記する
- 変更履歴を記録し、バージョニングを行う
